FROM alpine:3.18.2
LABEL maintainer=David\ Rabkin\ <david@rabkin.co.il>
ENV \
	TIME_ZONE=Asia/Jerusalem \
	USER=shellbase
COPY LICENSE /licenses/LICENSE
WORKDIR /bin
COPY --from=ghcr.io/rdavid/goredoer:0.9.20230710 /goredo .
RUN \
	apk add --no-cache --update \
		bash~=5.2 \
		curl~=8.1 \
		dash~=0.5 \
		fish~=3.6 \
		grep~=3.10 \
		loksh~=7.3 \
		shellcheck~=0.9 \
		shfmt~=3.6 \
		tcsh~=6.24 \
		tzdata~=2023 \
		zsh~=5.9 \
		util-linux~=2 \
		yamllint~=1.31 \
		yash~=2.54 \
		&& rm -rf /var/cache/apk/* \
		&& addgroup -S "$USER" \
		&& adduser -S "$USER" -G "$USER" \
		&& cp /usr/share/zoneinfo/$TIME_ZONE /etc/localtime \
		&& printf %s "$TIME_ZONE" > /etc/timezone \
		&& goredo -symlinks
USER "$USER"
WORKDIR /home/"$USER"
COPY \
	--chown="$USER":"$USER" \
	. .
CMD \
	[ "redo", "-j=10", "-x", "lint", "test" ]
